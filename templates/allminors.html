<!DOCTYPE html>
<html lang="en">
<head>
<link rel="icon" href="static/images/icon.png" type="image/png">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TigerPlan</title>
 <!-- Include jQuery from a CDN -->
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<style> * {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}
#right-container {
  width: 65%; /* Adjust based on your layout */
  float: left; /* If you are using a float-based layout */
  /* For Flexbox, you'd adjust accordingly */
}

.minor-button {
    width: 100%;
    padding: 10px;
    margin: 0px;
    background-color: #F7A072;
    /*color should be a good contrast to background color*/
    color: black;
    border: none;
    cursor: pointer;
    text-align: left; /* align to left with padding*/
    padding-left: 20px;
    font-size: 15px;
    border-radius: 0;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); /* Add box shadow for depth */
    transition: transform 0.2s ease-in-out; /* Add smooth transition on hover */

    /* 3D effect on hover */
    &:hover {
        transform: translateY(-2px); /* Move button up slightly on hover */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Increase shadow size on hover */
    }
}

/* Apply styles to even-indexed (2n) buttons */
.minor-button:nth-child(even) {
    background-color: coral; /* Background color for even-indexed buttons */
    color: black; /* Text color for even-indexed buttons */
}

/* Apply styles to odd-indexed (2n+1) buttons */
.minor-button:nth-child(odd) {
    background-color: #FF9B42; /* Background color for odd-indexed buttons */
    color: black; /* Text color for odd-indexed buttons */
}

#drop-area {
  min-height: 450px;
  max-height: 450px; /* Set the maximum height for scrolling */
  overflow-y: auto; /* Enable vertical scrolling when content overflows */
  background-color:  #ADD7cd; 
  border: 2px dashed #CCCCCC;
  border-radius: 5px;
  padding: 20px;
  display: flex;
  flex-wrap: wrap; /* Enable wrapping of items */
  justify-content: space-between; /* Distribute items evenly between columns */
  margin-bottom: 20px; /* Spacing between this container and the button */
}

.grid-item {
  width: calc(50% - 10px); /* Calculate width for two columns with gap */
  height: auto; /* Set a fixed height for each item */
  margin-bottom: 10px;
  padding: 20px;
  background-color: #ffd699;
  border-radius: 20px;
  cursor: move;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
  box-sizing: border-box;
}

#drop-area p {
  color: #666666; /* A light text color that's easy on the eyes */
  font-size: 20px; /* Large enough to be easily readable */
}

#left-container {
  /* height should be length of the window */
  max-height: 764px;
  height: auto; /* Set the maximum height for scrolling */
  overflow-y: auto; /* Enable vertical scrolling when content overflows */
  width: 20%; /* Adjust width as necessary */
  background-color: #F7A072; /* For contrast against the class items */
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Shadow for depth */
  margin-right: 120px; /* Spacing between this container and whatever is to the right */
  margin-left: 0px; /* Spacing between this container and whatever is to the right */
  float: left; /* Align it to the left */
  border-radius: 5px;
}

#class-input {
  width: 95%; /* Full width of the container */
  padding: 10px; /* Padding for aesthetic spacing inside the input */
  border: none; /* Removes border */
  border-bottom: 1px solid #ccc; /* Adds a light border to the bottom edge */
  font-size: 16px; /* Increases font size for readability */
  margin: 10px; /* Spacing around the input */
}

#class-list {
  padding: 10px; /* Padding inside the container around the class items */
}

body {
  background-color: #C8F6EB;
  font-family: 'Roboto Serif', serif;
}

#container {
  width: 80%;
  margin: auto;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.course {
  padding: 20px;
  margin-bottom: 20px;
  background-color: #F7A072;
  border-radius: 20px;
  cursor: move; /* Indicate draggable items */
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
}

.course h2, .course p {
  margin: 0;
}


.custom-link {
  text-decoration: none; /* This removes the underline */
  color: inherit; /* This will make the text use the color of its parent elements, or you can set a specific color */
}

.clearfix::after {
  content: "";
  display: table;
  clear: both;
}

#recommend-minors-btn {
  display: block;
  width: 30%;
  align-items: center;
  margin-bottom: 50px;
}

@media (max-width: 1200px) and (min-width: 801px) {
   #right-container {
      float: left; /* Set float to left for right container */
      margin-right: 0; /* Remove right margin */
    }
  }

   /* Media query for smaller screens */
  @media (max-width: 800px) {
    body {
      font-size: 14px; /* Reduce base font size for smaller screens */
    }

    #container {
      width: 90%; /* Adjust container width for smaller screens */
    }

    #right-container {
      width: 100%; /* Adjust container width for smaller screens */
    }

    #left-container {
      width: 100%;
      min-height: 200px;
      max-height: 300px; /* Adjust the maximum height as needed */
      margin-left: auto;
      margin-right: auto;
      

    }

    #right-container, #left-container,#recommend-minors-btn{
      
      float: none; /* Remove float to stack containers vertically */
    }

  }

</style>
<link rel="stylesheet" type="text/css" href= "{{ url_for('static',filename='styles/try_style.css') }}" >
</head>
<body>

  {% set username = username %}
  {% include 'header.html' %}

<main>
  <section id="allminors">
    <div id="left-container">
      <div id="minor-list">
        <!--Minor list buttons-->
        {% for minor in minors %}
        <button class="minor-button" data-code="{{ minor['code'] }}">
            {{ minor['code'] }} - {{ minor['name'] }}
          </button>
        {% endfor %}
      </div>
    </div> 
  </section>


  <div id="right-container">
    <section id="main-content">
        <p><span class="roboto">What minors are </span><span class="caveat">you</span><span class="roboto"> closest to?</span></p>
      </section>
      <p><center id = "sub">Click on a minor to see how close you are to earning it!</center></p>
      <br>
    <div id="minor-card-container">
    </div>
  </div>
</main>

<script>
  'use strict';
  $(document).ready(function() {
    function debounce(func, wait, immediate) {
        var timeout;
        return function() {
            var context = this, args = arguments;
            var later = function() {
                timeout = null;
                if (!immediate) func.apply(context, args);
            };
            var callNow = immediate && !timeout;
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
            if (callNow) func.apply(context, args);
        };
    }
    var debouncedFetchMinorInformation = debounce(function(minorCode) {
        $.ajax({
            url: '/distance',
            method: 'GET',
            data: { code: minorCode },
            success: function(response) {
                $('#minor-card-container').html(response);
                adjustFontSize(); // Adjust font size after content is loaded
            },
            error: function(error) {
                console.error('Error fetching minor information:', error);
            }
        });
    }, 300); // Set debounce delay to 300 milliseconds
    // Function to adjust font size based on text length
    function adjustFontSize() {
        // Select all elements with class 'node'
        var nodes = document.querySelectorAll('.node');

        // Loop through each node element
        nodes.forEach(function(node) {
            // Get the text content length
            var textLength = node.textContent.trim().length;

            // Calculate font size based on text length (example logic)
            var fontSize = 100 - (textLength * 2); // Adjust as per your requirement

            // Set the calculated font size to the node element
            node.style.fontSize = fontSize + '%';
        });
    }

    function adjustModalTitleSize() {
        console.log('Adjusting modal title size');
        var modalTitle = document.querySelector('.modal-title');
        var textLength = modalTitle.textContent.trim().length;

        // Define a base font size and adjust based on text length
        var baseFontSize = 35; // Base font size in pixels
        var minFontSize = 25; // Minimum font size in pixels
        var maxTextLength = 23; // Define a maximum text length to base font size on

        console.log('Text length:', textLength);

        // Calculate font size based on text length within the defined range
        var fontSize;
        
        if (textLength <= maxTextLength) {
            // Calculate font size linearly based on text length
            fontSize = 55

        } else {
            // Apply additional scaling for longer text lengths
            fontSize = baseFontSize - (baseFontSize - minFontSize) * 2* (textLength / maxTextLength);
        }

        // Ensure font size stays within the defined range
        fontSize = Math.max(fontSize, minFontSize); // Ensure font size doesn't go below minFontSize
        fontSize = Math.min(fontSize, baseFontSize); // Ensure font size doesn't exceed baseFontSize

        // Apply the calculated font size to the modal title
        modalTitle.style.fontSize = fontSize + 'px';
    }


    // Event listener for minor button click
    $(document).on('click', '.minor-button', function() {
        var minorCode = $(this).data('code');
        debouncedFetchMinorInformation(minorCode);
    });

    // Function to fetch and display minor information
    function fetchMinorInformation(minorCode) {
        $.ajax({
            url: '/distance',
            method: 'GET',
            data: { code: minorCode },
            success: function(response) {
                $('#minor-card-container').html(response);
                adjustFontSize(); // Adjust font size after content is loaded
            },
            error: function(error) {
                console.error('Error fetching minor information:', error);
            }
        });
    }

    // Function to generate HTML based on JSON data
    function generateHTML(jsonData) {
        // Function to create HTML for a single node
        function createNodeHtml(node) {
            const nodeElement = document.createElement('div');
            nodeElement.className = 'node';
            nodeElement.innerHTML = `
                <div class="reqname">${node.name} (${node.classes_taken}/${node.classes_needed})</div>
                <div class="details">
                    <div class="subreqname">Details</div>
                    <div class="summary-info">
                        <div>Classes taken: ${node.classes_taken}</div>
                        <div>Classes needed: ${node.classes_needed}</div>
                        <div>Classes remaining: ${node.classes_remaining}</div>
                        <div class="classlist">
                            <div class="classlist_label">Your Classes:</div>
                            <ul>
                                ${node.class_list.map(className => `<li>${className}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                </div>
            `;
            return nodeElement;
        }

        // Function to recursively append children
        function appendChildren(parentElement, children) {
            children.forEach(child => {
                const childElement = createNodeHtml(child);
                
                if (child.children && child.children.length > 0) {
                    childElement.querySelector('.details').innerHTML += `
                        <div class="reqname">...</div>
                        <div class="children-container"></div>
                    `;
                    const childrenContainer = childElement.querySelector('.children-container');
                    appendChildren(childrenContainer, child.children);
                    childElement.querySelector('.details').appendChild(childrenContainer);
                }
                parentElement.appendChild(childElement);
            });
        }

        const rootElement = document.createElement('div');
        rootElement.className = 'root-container';
        
        if (jsonData.children && jsonData.children.length > 0) {
            appendChildren(rootElement, jsonData.children);
        } else {
            rootElement.appendChild(createNodeHtml(jsonData));
        }

        return rootElement.outerHTML;
    }

    // Function to open modal with specified minor and description
    function openModal(minor, desc) {
        var modalId = minor + "-modal";
        var modal = document.getElementById(modalId);
        console.log(modal);
        if (modal) {
            //modal background color should match card color
            //var cardBackgroundColor = window.getComputedStyle(card).getPropertyValue("background-color");
            //modalContent.style.backgroundColor = cardBackgroundColor;

            modal.style.display = "block";
        }
        var modalContent = modal.querySelector(".modal-content");
        //modalContent.querySelector("h2").textContent = minor;
        // Adjust the font size of the modal title based on text length
        adjustModalTitleSize();

        // Retrieve the data-tree attribute (JSON string)
        var treeDescription = modalContent.querySelector(".grey-boxes").getAttribute("data-tree");
        
        console.log('treeDescription', treeDescription);

        if (!treeDescription) {
            // fill the modal with the description
            modalContent.querySelector("#description").textContent = desc;
            // fill grey-boxes with message "you have no classes that count toward this minor!"
            modalContent.querySelector(".grey-boxes").innerHTML = "<p>You have no classes that count toward this minor!</p>";

            return;
        }

        // Use the new generateHTML function
        var generatedHTML = generateHTML(JSON.parse(treeDescription));


        // Insert the generated HTML into the modal content container
        var htmlContainer = modalContent.querySelector(".grey-boxes");
        console.log("here is the generated html")
        console.log(generatedHTML)
        htmlContainer.innerHTML = generatedHTML;
        //htmlContainer.set('html', generatedHTML);

        if (htmlContainer.childNodes.length) {
            attachToggleListeners();
        }

        // Get the paragraph element to display the description
        let descriptionParagraph = modalContent.querySelector("#description");
        console.log('description paragraph', descriptionParagraph.textContent);

        // Check if the description length exceeds the maximum length
        
        descriptionParagraph.textContent = desc; // Show full description
        modalContent.querySelector(".modal-descBox").style.overflowY = "auto"; // Enable scrolling

        
        modalContent.querySelector(".grey-boxes").style.overflowY = "auto"; // Enable scrolling
    }

    // Event delegation for dynamically added elements
    $(document).on('click', '.course-card', function() {
        var minor = $(this).data('minor');
        var desc = $(this).data('desc');
        openModal(minor, desc);
    });

    // Event delegation for modal close buttons
    $(document).on('click', '.close', function() {
        $(this).closest(".modal").hide();
    });

    // Event listener to close modals when clicking outside
    $(document).on('click', function(event) {
        if ($(event.target).hasClass("modal")) {
            $(".modal").hide();
        }
    });

    adjustFontSize(); // Initial font size adjustment


});
    
</script>

</body>
</html>
