<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TigerPlan</title>
<link rel="stylesheet" type="text/css" href= "{{ url_for('static',filename='styles/try_style.css') }}" >
<style>
  
  .card {
    background-color: #FF9B42; /* card background color */
    margin-bottom: 10px;
    padding: 20px;
    text-align: center;
    cursor: pointer;
    border: 0px solid black; /* card border */
    border-radius: 20px;
    transition: transform 0.2s; /* smooth transform on hover */
    font-family: 'Caveat Brush', brush;
    width: 325px;
    height: 450px; 
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3)
  }

  .card p {
    font-family: 'Roboto Serif', serif;
    font-size: 30px;
    margin-top: 20%;
    flex: 1; /* Let the title take up space evenly */
  }

  .card h3 {
    word-wrap:break-word;

  }
  .card:hover {
    transform: translateY(-5px); /* raise the card slightly on hover */
  }

  .card:nth-child(2) {
    background-color: #F7A072; /* second card background color */
  }

  .card:nth-child(3) {
    background-color: #ffd699; /* third card background color */
  }

  .card-title {
    font-size: 40px; /* title font size */
    margin-bottom: 5px;
  }

  .card-text {
    font-size: 16px; /* text font size */
    flex: 1; /* Let the title take up space evenly */
    margin-bottom: 50px;
  }

  .container {
    display: flex;
    justify-content: center; /* Centers the cards in the container */
    flex-wrap: wrap; /* Allows cards to wrap to next line on small screens */
    gap: 20px; /* Adjust the space between cards */
    padding: 20px;
    justify-content: center; /* Centers the cards horizontally */
    align-items: center; /* Centers the cards vertically */
  }


  /* Styles for the modal popup */
  .modal {
    display: none;
    position: fixed;
    z-index: 9999;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.5); /* Black background with transparency */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3)
  }

  .modal-content {
    background-color: #FF9B42; /* Light grey background */
    margin: 10% auto; /* Adjust vertical margin for centering */
    padding: 40px; /* Increase padding for content spacing */
    border: 0px solid #e0e0e0; /* card border */
    border-radius: 20px;
    width: 95%; /* Increase width to 90% of the viewport */
    max-width: 1100px; /* Set maximum width for larger screens */
    height: 70%; /* Increase width to 90% of the viewport */
    max-height: 600px; /* Set maximum width for larger screens */
    text-align: center;
    font-family: 'Roboto Serif', serif;
    font-size: 30px; /* text font size */
    position: relative; /* Ensure relative positioning for absolute positioned close button */
    word-wrap: break-word;

  }

  .modal-content:nth-child(2) {
    background-color: #F7A072; 
  }

  .modal-content:nth-child(3) {
    background-color: #ffd699; 
  }


  .modal-descBox {
    background-color: #FFFFCC; /* Light yellow background */
    /*margin-bottom: 10px;*/
    padding: 20px;
    text-align: center;
    font-family: 'Caveat Brush', brush;
    width: calc(50% - 40px); /* Set width to half of the modal width minus padding */
    position: absolute; /* Position absolutely within the modal */
    top: 50%; /* Align to the vertical center */
    right: 20px; /* Align to the right */
    transform: translateY(-50%); /* Adjust for vertical centering */
    border-radius: 10px; /* Add rounded corners */

    width: 50%; /* Increase width to 90% of the viewport */
    max-width: 450px; /* Set maximum width for larger screens */
    height: 85%; /* Increase width to 90% of the viewport */
    max-height: 700px; /* Set maximum width for larger screens */

  }
  .modal-content .modal-descBox p {
    font-size: 20px; /* Adjust the font size as needed */
  }
  .modal-content h2 {
    font-family: 'Caveat Brush', brush;
    font-size: 55px; /* title font size */
    margin-bottom: 10px;
    margin-left: 20px; /* Adjust the left margin to move it more towards the center */
    margin-right: auto; /* Set right margin to auto for centering */
    text-align: left; /* Align the text to the left */
  }

  .modal-content p {
    font-family: 'Roboto Serif', serif;
    font-size: 30px; /* text font size */
  }

  .grey-boxes {
    overflow-y: auto;
    display: flex;
    flex-direction: column; /* Stack boxes vertically */
    align-items: flex-start; /* Align to the left */
    margin-top: 15px;

    background-color: #C6C6C6;

    /*margin-bottom: 10px;*/
    padding: 30px;
    text-align: center;
    width: calc(50% - 30px); /* Set width to half of the modal width minus padding */
    position: absolute; /* Position absolutely within the modal */
    top: 60%; /* Align to the vertical center */
    left: 20px; /* Align to the right */
    transform: translateY(-60%); /* Adjust for vertical centering */
    border-radius: 10px; /* Add rounded corners */

    width: 70%; /* Increase width to 90% of the viewport */
    max-width: 500px; /* Set maximum width for larger screens */
    height: 70%; /* Increase width to 90% of the viewport */
    max-height: 700px; /* Set maximum width for larger screens */

  }

  .root-container {
    display: flex;
    width: 90%;
    height: 100%;
    margin: 0;
    flex-direction: column;
    align-items: center;
    padding:0px;
    background-color: #C6C6C6;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  }
  
  .node {
    overflow-y: auto;  
    background-color: #ffd699;
    width: 100%; /* Set width to 45% of the modal */
    max-width: 500px;
    height: auto; /* Set height to auto */
    margin-bottom: 20px; /* Add margin between boxes */
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Add shadow effect */
    z-index: 2;
    position: relative; /* Needed for absolute positioning of the arrow */
    padding-left: 30px; /* Make space for the arrow */

  }

  .reqname::before {
    content: '▶'; /* Right-pointing arrow */
    font-size: 12px; /* Smaller arrow size */
    margin-right: 5px;
    cursor: pointer; /* Change cursor to indicate this can be clicked */
  }

  /* Style for the toggle arrow when the container is open */
  .reqname.open::before {
    content: '▼'; /* Downward-pointing arrow when open */
  }

  /* Initially hide the details and child lists */
  .details, .children-container {
    display: none;
  }

  /* Show the details and child lists when their parent is open */
  .reqname.open + .details, .children-container.open {
    display: block;
  }

  /* Style for classlist */
  .classlist {
    margin-left: 20px; /* Adjust margin to align with reqname */
  }

  .classlist_label::before {
    font-weight: bold; /* Make the label bold */
    content: '▼'; /* Downward-pointing arrow when open */
    font-size: 12px; /* Smaller arrow size */
  }

  /* Adjust the arrow direction for open state */
  .classlist_label.open::before {
    content: '▶'; /* Downward-pointing arrow when open */
  }

  /* Show classlist when its parent is open */
  .reqname.open + .details .classlist {
    display: block;
  }

  /* Ensure list items are displayed properly */
  .classlist ul {
    margin: 0;
    padding: 0;
  }

  /* Ensure list items have proper spacing */
  .classlist ul li {
    list-style-type: none; /* Remove default list style */
    margin-left: 20px; /* Adjust margin to align with reqname and classlist */
  }

  .close {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 30px;
    cursor: pointer;
    color: #000; /* Adjust color for visibility */
  }

  /* Styles for description paragraph */
  .modal-content p {
      font-size: 20px;
      overflow: hidden; /* Hide overflow content */
      text-overflow: ellipsis; /* Show ellipsis (...) for overflow text */
      /*white-space: nowrap; /* Prevent text wrapping */
      cursor: pointer; /* Set cursor to pointer for clickable text */
  }

  /* Styles for scrolling description */
  .modal-content p.full-description {
    overflow-y: auto; /* Hide vertical scrollbar initially */
    max-height: 200px; /* Limit maximum height before scrolling */
  }
</style>
</head>
<body>

{% set username = username %}
{% include 'header.html' %}
<main>
  <section id="main-content">
    <p>Here are your most compatible minors!</p>
  </section>
  <center>
  <p>Click on a card to learn more!</p>
  </center>
  <div class="container">
    {% for course in courses %}
    <div id="{{ course['minor'] }}" class="card course-card" data-minor="{{ course['minor'] }}" data-desc="{{ course['desc'] }}">
        <h3 class="card-title">{{ course['minor'] }}</h3>
        <p>  </p>
        <p class="card-text" style='line-height: 8px;'>You need</p>
        <h1 style='line-height: 1px; font-size: 50px;'>{{ course['distance'] }} </h1>
        <p>more classes to fulfill this minor!</p>
    </div>

    <!-- Modal for {{ course['minor'] }} -->
    <div id="{{ course['minor'] }}-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>{{ course['minor'] }}</h2>
              
            <div class="grey-boxes" data-tree="{{course['tree_description']}}">
            </div>
            <div id="modal-text"></div>
            <div class= "modal-descBox">
              <p id = "description" class = "modal-descText"></p>
            </div>
      
        </div>
    </div>
    {% endfor %}
  </div>
</main>x
<script>

  document.addEventListener("DOMContentLoaded", function() {
    // Get all course cards
    var courseCards = document.querySelectorAll(".course-card");

    // Loop through each course card
    courseCards.forEach(function(card) {
        // Add click event listener to each course card
        let minor = card.getAttribute("data-minor");
        let desc = card.getAttribute("data-desc");
        // Get the data attributes from the clicked course card
        card.addEventListener("click", function() {
            // Call the openModal function with the extracted data
            openModal(minor, desc);
        });
    });

    // Get all modal close buttons (assuming they have a class of "close")
    var modalCloseButtons = document.querySelectorAll(".close");

    // Loop through each modal close button
    modalCloseButtons.forEach(function(button) {
        // Add click event listener to each button
        button.addEventListener("click", function() {
            // Get the closest modal (parent modal) to the button clicked
            var modal = this.closest(".modal");
            
            // If modal element exists, hide it
            if (modal) {
                modal.style.display = "none";
            }
        });
    });

    // When the user clicks anywhere outside of a modal, close it
    window.onclick = function(event) {
        // Check if click event occurred outside of any modal
        if (event.target.classList.contains("modal")) {
            // Hide all modals (assuming modals have a class of "modal")
            var modals = document.querySelectorAll(".modal");
            modals.forEach(function(modal) {
                modal.style.display = "none";
            });
        }
    };
});

  function generateHTML(jsonData) {
    // Function to create HTML for a single node
    function createNodeHtml(node) {
      const nodeElement = document.createElement('div');
      nodeElement.className = 'node';
      nodeElement.innerHTML = `
      <div class="reqname">${node.name}</div>
      <div class="details">
       <div class="summary-info">
        <div>Classes taken: ${node.classes_taken}</div>
        <div>Classes needed: ${node.classes_needed}</div>
        <div>Classes remaining: ${node.classes_remaining}</div>
      </div>
        <div class="classlist">
          <div class="classlist_label">Your Classes:</div>
          <ul>
            ${node.class_list.map(className => `<li>${className}</li>`).join('')}
          </ul>
        </div>
        
      </div>
      `;
      return nodeElement;
    }

    // Function to recursively go through the tree and append children
    function appendChildren(parentElement, children) {
      children.forEach(child => {
        const childElement = createNodeHtml(child);
        
        if (child.children && child.children.length > 0) {
          // to the childelement add a div <div class="reqname">Subrequirements</div>
          // and then a div <div class="children"></div> that will actually contain the children
          childElement.querySelector('.details').innerHTML += `
          <div class="reqname">Subrequirements</div>
          <div class="children-container"></div>
          `;
          const childrenContainer = childElement.querySelector('.children-container');
          appendChildren(childrenContainer, child.children);

          // append to the child element details div
          childElement.querySelector('.details').appendChild(childrenContainer);
        }
        parentElement.appendChild(childElement);
      });
    }

    // Start with the root element and call appendChildren if children are present
    const rootElement = document.createElement('div');
    // center the root element
    rootElement.style.margin = 'auto';
    rootElement.className = 'root-container';
    if (jsonData.children && jsonData.children.length > 0) {
      console.log("heres a child")
      appendChildren(rootElement, jsonData.children);
    } else {
      // If there are no children, just append the root node
      console.log("im the last child")
      rootElement.appendChild(createNodeHtml(jsonData));
    }

    // Return the outer HTML of the root element
    return rootElement.outerHTML;
  }


// Function to open the modal with specified minor and desc
function openModal(minor, desc) {
    // Get the corresponding modal element by ID
    var modal = document.getElementById(minor + "-modal");
    
    // If modal element exists, display it
    if (modal) {
      //modal background color should match card color
      //var cardBackgroundColor = window.getComputedStyle(card).getPropertyValue("background-color");
      //modalContent.style.backgroundColor = cardBackgroundColor;

      modal.style.display = "block";
    }

    // You can populate modal content dynamically using the passed 'minor' and 'desc'
    var modalContent = modal.querySelector(".modal-content");
    modalContent.querySelector("h2").textContent = minor;

    // Retrieve the data-tree attribute (JSON string)
    var treeDescription = modalContent.querySelector(".grey-boxes").getAttribute("data-tree");
    
    console.log('treeDescription', treeDescription);

    // Use the new generateHTML function
    var generatedHTML = generateHTML(JSON.parse(treeDescription));


    // Insert the generated HTML into the modal content container
    var htmlContainer = modalContent.querySelector(".grey-boxes");
    console.log("here is the generated html")
    console.log(generatedHTML)
    htmlContainer.innerHTML = generatedHTML;
    //htmlContainer.set('html', generatedHTML);

    if (htmlContainer.childNodes.length) {
          attachToggleListeners();
      }

    // Get the paragraph element to display the description
    let descriptionParagraph = modalContent.querySelector("#description");
    console.log('description paragraph', descriptionParagraph.textContent);

    // Check if the description length exceeds the maximum length
    
    descriptionParagraph.textContent = desc; // Show full description
    modalContent.querySelector(".modal-descBox").style.overflowY = "auto"; // Enable scrolling

    
    modalContent.querySelector(".grey-boxes").style.overflowY = "auto"; // Enable scrolling

    // Add toggle functionality to grey boxes
    


}
function attachToggleListeners() {
  // Toggle functionality for the requirement names
  document.querySelectorAll(".reqname").forEach(function(reqname) {
    reqname.addEventListener("click", function() {
      // Toggle visibility of this requirement's details
      var details = this.nextElementSibling; // Assuming the details follow immediately after
      details.style.display = details.style.display === "block" ? "none" : "block";
      console.log('display called!');

      // reqname has to be toggled open
      this.classList.toggle('open');
    });
  });

  // Toggle functionality for the class list
  document.querySelectorAll(".classlist").forEach(function(classlist) {
    classlist.addEventListener("click", function() {
      // Toggle visibility of this class list's details
      var ulElement = this.querySelector('ul'); // Assuming the details follow immediately after
      // toggle open for the classlist_label
      this.querySelector('.classlist_label').classList.toggle('open');
      ulElement.style.display = (ulElement.style.display === 'none') ? 'block' : 'none';
    });
  });

  // Toggle functionality for the children-container
  /*document.querySelectorAll(".children-container").forEach(function(subreq) {
    subreq.previousElementSibling.addEventListener("click", function(event) {
      // This will prevent the click from affecting the subrequirements themselves
      event.stopPropagation();
      
      // Toggle visibility of subrequirements
      subreq.classList.toggle('open');
      subreq.style.display = subreq.style.display === "none" ? "block" : "none";
    });
  });*/
}

</script>


</body>
</html>
